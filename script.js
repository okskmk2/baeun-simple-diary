let isEditMode=!1;window.addEventListener("keydown",function(e){e.ctrlKey&&"Enter"==e.key&&addPost()});const countWithRegex=(e,t)=>((e||"").match(new RegExp(t,"g"))||[]).length;function textareaShortCutKey(e,t,n){e.addEventListener("keydown",function(s){"Escape"==s.key?(s.preventDefault(),n()):s.ctrlKey&&"s"===s.key&&(s.preventDefault(),t()),e.offsetHeight<e.scrollHeight&&(e.style.height=e.scrollHeight+16+"px")})}function now(){return(new Date).toLocaleString()}function generatePostNum(){localStorage.getItem("post_seq")||localStorage.setItem("post_seq",0);let e=parseInt(localStorage.getItem("post_seq"));return++e}const posts_container=document.getElementById("posts_container");function updatePost(){const e=parseInt(this.dataset.postId),t=this.querySelector(".title_div textarea"),n=JSON.parse(localStorage.getItem("posts"));let s=-1,o=null;for(let t=0;t<n.length;t++){const a=n[t];if(a.id===e){s=t,o=a;break}}n[s]=Object.assign(o,{title:t.value,updateAt:now()}),localStorage.setItem("posts",JSON.stringify(n)),loadPosts()}function renderUpdatePostInput(){if(console.log("renderUpdatePostInput"),isEditMode)return void console.log(message.already);isEditMode=!0;this.querySelector(".update_button").classList.add("hide"),this.querySelector(".delete_button").classList.add("hide"),this.querySelector(".cancel_button").classList.remove("hide"),this.querySelector(".update_button2").classList.remove("hide");const e=this.querySelector(".title_div"),t=e.innerHTML,n=document.createElement("textarea");textareaShortCutKey(n,updatePost.bind(this),loadPosts),n.value=t;let s=countWithRegex(t,"\n");n.style.height=24*s+16+"px",e.innerHTML=null,e.appendChild(n),n.focus()}function deletePost(){if(confirm(message.deleteConfirm)){const e=this.parentElement.parentElement.parentElement,t=parseInt(e.dataset.postId);let n=JSON.parse(localStorage.getItem("posts"));n=n.filter(e=>e.id!==t),localStorage.setItem("posts",JSON.stringify(n)),loadPosts()}}function renderPost(e){const t=document.createElement("article");t.classList.add("post-item"),t.dataset.postId=e.id;const n=document.createElement("div");n.classList.add("title_div"),n.innerHTML=e.title;const s=document.createElement("div");s.className="post-button-group";const o=document.createElement("button");o.classList.add("update_button"),o.addEventListener("click",renderUpdatePostInput.bind(t)),o.innerHTML=message.update,s.appendChild(o);const a=document.createElement("button");a.classList.add("delete_button"),a.addEventListener("click",deletePost),a.innerHTML=message.delete,s.appendChild(a);const d=document.createElement("button");d.classList.add("cancel_button"),d.classList.add("hide"),d.addEventListener("click",loadPosts),d.innerHTML=message.cancel,s.appendChild(d);const l=document.createElement("button");l.classList.add("update_button2"),l.classList.add("hide"),l.addEventListener("click",updatePost.bind(t)),l.innerHTML=message.save,s.appendChild(l);const c=document.createElement("div");c.classList.add("post-inner");const i=document.createElement("div"),r=document.createElement("div");return r.classList.add("create-at"),r.innerHTML=e.createAt,i.classList.add("meta-data"),i.appendChild(r),c.appendChild(i),c.appendChild(n),c.appendChild(s),t.appendChild(c),t}function loadPosts(){console.log("loadPosts"),posts_container.innerHTML=null,localStorage.getItem("posts")||localStorage.setItem("posts","[]");const e=JSON.parse(localStorage.getItem("posts"));for(const t of e){const e=renderPost(t);posts_container.appendChild(e)}isEditMode=!1}const add_button=document.getElementById("add_button");function savePost(){console.log("savePost");const e=this.querySelector("textarea").value,t=generatePostNum();localStorage.getItem("posts")||localStorage.setItem("posts","[]");const n=JSON.parse(localStorage.getItem("posts"));n.unshift({id:t,title:e,createAt:now()}),localStorage.setItem("posts",JSON.stringify(n)),localStorage.setItem("post_seq",t),loadPosts()}function renderNewPostInput(){const e=document.createElement("article");e.classList.add("post-item");const t=document.createElement("div"),n=document.createElement("textarea");textareaShortCutKey(n,savePost.bind(e),loadPosts),t.appendChild(n);const s=document.createElement("div");s.className="post-button-group";const o=document.createElement("button");o.classList.add("cancel_button"),o.addEventListener("click",loadPosts),o.innerHTML=message.cancel,s.appendChild(o);const a=document.createElement("button");a.innerHTML=message.save,a.addEventListener("click",savePost.bind(e)),s.appendChild(a);const d=document.createElement("div");return d.classList.add("post-inner"),d.appendChild(t),d.appendChild(s),e.appendChild(d),e}function addPost(){if(isEditMode)return void console.log(message.already);isEditMode=!0;const e=renderNewPostInput();posts_container.firstElementChild?posts_container.insertBefore(e,posts_container.firstElementChild):posts_container.appendChild(e),e.querySelector("textarea").focus()}add_button.addEventListener("click",addPost);const help_button=document.getElementById("help_button");help_button.addEventListener("click",function(){alert(message.help)}),loadPosts();